# Advanced data wrangling {#adv-dplyr}

![](https://img.shields.io/badge/document%20status-in%20progress-red?style=flat-square)

```{r, eval=TRUE, child="resources/preamble.Rmd"}
```

`r '<!-- '`

## Combining datasets

Include this here?

```{r, eval=FALSE}
library(dplyr)
user_1_fix %>% bind_cols(user_1_rr_fix)

# %>% 
#     rename(inter_beat_interval_seconds = ibi_s)
```

```{r}
library(vroom)
library(here)
library(dplyr)
user_1_rr_file <- here("data-raw/mmash/user_1/RR.csv")
user_1_rr_data <- vroom(
    user_1_rr_file,
    col_select = -1,
    col_types = cols(
        ibi_s = col_double(),
        day = col_double(),
        # Converts to seconds
        time = col_time(format = "")
    )
) %>% 
    rename(inter_beat_interval_seconds = ibi_s)

library(ggplot2)
ggplot(user_1_rr_data, aes(x = time, y = inter_beat_interval_seconds)) +
    geom_line() +
    facet_grid(rows = vars(day))

user_1_rr_data %>% 
    group_by(day) %>% 
    summarize(across(inter_beat_interval_seconds, 
                     list(mean = mean, min = min, max = max)))

user_1_rr_data %>% 
    group_by(day) %>% 
    # functional programming
    summarize(across(inter_beat_interval_seconds, 
                     list(mean = mean, min = min, max = max, sd = sd)))


```


- functionals
- load all datasets
- 

Day 1 afternoon (13:15, end at 17:30 --- ~4.25 hrs, with one big break, two small ones during exercise):

- functional programming
    - Q: Any one use for loops? Instead you should use functionals like map (R's
    strength is this)
    - talk about and introduce here
        - weaknesses of loops, strengths of functionals
        - naive approach to find mean (or do simple transformations) of each
        column is to do for loop with mean of each column in dataset
        - Images inspired from advanced R
            - Use diagrammer graphviz?
    - This section prepares for the functional programming session
- deeper into dplyr
    - tidyselect helpers
    - across and where
    - regular expressions?
    - joins
    - Possible uses:
        - calculating mean
            - summarize across is numeric (select where is.numeric)
            - show off the ... here (like with na.rm)
            - Like for the RR or actigraph
        - Any time you think you would use a for loop, use this.
        
- saving intermediate/final output

## Misc

Some best practices

Here are a few tips for being efficient. Also check out the resources at the 
bottom for more places to learn about being efficient.

- Aggressively keep your code as simple and concise as you can. The less code
you have to write, debug, and maintain, the better. If you repeat code, stop and
think how to not repeat it. You will save time in the end by taking time to think
and plan.
- Try to always think in terms of wrangling data as data.frames. There is a lot
of power and utility from structure most things as data.frames. (e.g. "how can I
get the dataframe to the form I need to make a figure?")
- Keep learning. Keep reading books and help documentation. Keep taking courses
and workshops. And start teaching R to others! *hint hint* :wink: Seriously, it's
a great way for you to learn as it challenges you to know what you are talking 
about and teaching!
- When encountering a difficult problem, think about how to solve it, then try
to find R packages or functions that do your problem for you. You may hear some
poeple say "oh, don't bother with R packages, do everything in base R"... don't 
listen to them. Do you build a computer from scratch everytime you want to do
any type of work? Or a car when you want to drive somewhere? No, you don't. Make
use of other people's hard work to make tools that simplify your life.
- Use a [style guide] and create descriptive object names. Follow the [principles of tidy tools]
when creating functions and code.
- Split up your analyses steps into individual files (e.g. "model" file, "plot"
file). Then `source` those files as needed or save the output in `data/` to use 
it in other files.
- Try not to have R scripts be too long (e.g. more than 500 lines of code). Keep
script sizes as small as necessary and as specific as possible (have a single purpose).
A script should have an end goal.

[style guide]: https://style.tidyverse.org/

`r '-->'`
